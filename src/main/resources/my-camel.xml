<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

<bean id="customConnectionFactory" class="com.rabbitmq.client.ConnectionFactory">
  <property name="host" value="localhost"/>
  <property name="port" value="5672"/>
  <property name="username" value="guest"/>
  <property name="password" value="guest"/>
</bean>
<bean id="resource" class="com.my.demo.sbcamelrabbitmqkafka.processor.ResourceProcessor"/>

<camelContext id="SampleCamel" xmlns="http://camel.apache.org/schema/spring">
  <dataFormats>
    <json id="jack" library="Jackson" unmarshalTypeName="com.my.demo.sbcamelrabbitmqkafka.data.DeltaMessage"/>
  </dataFormats>

  <route>
      <from uri="timer:foo?period=36000"/>
      <log message="#############The message is generated by timer route #############"/>
      <to uri="mock:result"/>
  </route>

  <!-- This Route consume msg from rabbitMQ Queue that bound with exchange A with routing key B, get data from HTTP and publish it to Kafka -->
  <route>
    <from uri="rabbitmq://localhost:5672/A?routingKey=B"/>
    <log message="############# From RabbitMQ: ${body} #############"/>
    <unmarshal ref="jack"/>
    <to uri="bean:resource?method=getResource"/>
    <setHeader headerName="CamelHttpMethod">
        <constant>GET</constant>
    </setHeader>
    <setHeader headerName="X-REQUEST-ID">
        <constant>My-KafakaPublisher</constant>
    </setHeader>
    <setHeader headerName="resource">
        <constant>${body}</constant>
    </setHeader>
    <to uri="http4://localhost:9999/body"/>
    <to uri="kafka:test?brokers=localhost:9092&amp;compressionCodec=gzip"/>
    <log message="############# data sent to kafka #############"/>
   </route>

  <!-- This route consume msg from Kafka topic-->
  <route id="item_consumer">
  <from uri="kafka:test?brokers=localhost:9092&amp;compressionCodec=gzip"/>
  <log message="############# got data from kafka test topic #############"/>
  <to uri="log:com.my.demo.sbcamelrabbitmqkafka?level=INFO"/>
  </route>
  </camelContext>

</beans>